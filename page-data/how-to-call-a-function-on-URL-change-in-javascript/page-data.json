{"componentChunkName":"component---src-templates-blog-post-js","path":"/how-to-call-a-function-on-URL-change-in-javascript/","result":{"data":{"site":{"siteMetadata":{"title":"itsopensource"}},"markdownRemark":{"id":"ecd713c7-3465-5cb5-89dc-d1c7fc4fe6d5","excerpt":"Modern JS frameworks tend not to reload the page but manipulate DOM and change URL path for internal navigation, for performance and smooth UX. But since thereâ€¦","html":"<p>Modern JS frameworks tend not to reload the page but manipulate DOM and change URL path for internal navigation, for performance and smooth UX. But since there is no page reload, <code class=\"language-text\">window.onload</code> event does not get triggered for subsequent navigation. We run into a situation where we need to call a function whenever URL path changes (not the hash).</p>\n<h3>Problem</h3>\n<p>The <a href=\"https://itsopensource.com/\"><code class=\"language-text\">itsopensource.com</code></a> blog is built using <a href=\"https://www.gatsbyjs.org/\">gatsby</a>, we wanted to add google analytics to this, but instead of using google tag manager, we tried to restrict what <a href=\"https://github.com/tsl143/itsopensource/blob/master/src/html.js#L32\">data</a> is sent to google and in this process, we need to send XHR request on every page load. We created a function <code class=\"language-text\">sendTelemetry</code> and called it on <code class=\"language-text\">window.onload</code>. This works as expected (partially), whenever the page is loaded the XHR is sent, but gatsby do not reload the page while changing the URL when any blog link is clicked, so XHR is sent only once per session and not on subsequent page loads.<br>\nJavascript does not provide any native listener to path change (not hashchange).</p>\n<h3>Solution</h3>\n<p>The <code class=\"language-text\">history</code> API maintains complete the navigation state. Whenever a new page is navigated <code class=\"language-text\">history.pushState</code> is called and page is added to the state. That means this event is called whenever the URL changes. We hooked our function on this, and done :)</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">history</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> pushState <span class=\"token operator\">=</span> history<span class=\"token punctuation\">.</span>pushState<span class=\"token punctuation\">;</span>\n    history<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">pushState</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">state</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// YOUR CUSTOM HOOK / FUNCTION</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'I am called from pushStateHook'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> <span class=\"token function\">pushState</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span>history<span class=\"token punctuation\">,</span> arguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>history<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>Demo</h3>\n<p>A quick demo can be the following:</p>\n<ol>\n<li>Open the browser console on this very page.</li>\n<li>Paste the above-written code snippet.</li>\n<li>Keep console open and navigate various pages on this blog</li>\n<li>You should see a message in console on every navigation.</li>\n</ol>\n<br>\n<p><em>The first choice for the title was <code class=\"language-text\">how to hook a function on history.pushState</code>.</em>  </p>\n<p>Reference: <a href=\"https://stackoverflow.com/questions/4570093/how-to-get-notified-about-changes-of-the-history-via-history-pushstate\">stackoverflow</a>  ðŸ˜‰</p>","frontmatter":{"title":"How to call a function on URL change in javascript","tags":["javascript","react"],"date":"July 03, 2020","description":null,"author":"trishul","featuredImage":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/how-to-call-a-function-on-URL-change-in-javascript/","previous":{"fields":{"slug":"/how-to-reduce-node-docker-image-size-by-ten-times/"},"frontmatter":{"author":"shivam","tags":["docker","tricks","how-to"],"title":"How to Reduce Node Docker Image Size by 10X"}},"next":null}}}