{"componentChunkName":"component---src-templates-blog-post-js","path":"/how-to-serve-api-locally-with-webpack/","result":{"data":{"site":{"siteMetadata":{"title":"itsopensource"}},"markdownRemark":{"id":"2c32bcfb-b8bb-534c-816a-326ff41fd6ad","excerpt":"While developing a data driven web-app, the frontend may need to fetch data from various APIs provided by backend which may not be ready at the given time. Inâ€¦","html":"<p>While developing a data driven web-app, the frontend may need to fetch data from various APIs provided by backend which may not be ready at the given time. In this case, we need to mock the response and serve it via dummy server, either local or remote. With Webpack this can be achieved without any dummy server. Webpack devserver allows custom handlers which can be used to serve the API response.</p>\n<p>We need to add a <code class=\"language-text\">devServer</code> entry to the webpack config, which would look something like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./data.json\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">mode</span><span class=\"token operator\">:</span> <span class=\"token string\">\"development\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">entry</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./src/index\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">output</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">\"bundle.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">\"build\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">devServer</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">before</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">app</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      app<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/getData\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        res<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">open</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">port</span><span class=\"token operator\">:</span> <span class=\"token number\">3000</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">resolve</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">extensions</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\".js\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">module</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>There are various amazing things that we can do with devserver (check <a href=\"https://webpack.js.org/configuration/dev-server/\">here</a>), we consider three of them here</p>\n<ol>\n<li><code class=\"language-text\">open</code> - launch the browser once the app is compiled</li>\n<li><code class=\"language-text\">port</code> - set the port to serve the app</li>\n<li><code class=\"language-text\">before</code> - We can define custom paths with endpoints in this function, from the docs -</li>\n</ol>\n<blockquote>\n<p>Provides the ability to execute custom middleware prior to all other middleware internally within the server. This could be used to define custom handlers.</p>\n</blockquote>\n<p>So for given webpack config, if the content of data.json is - <code class=\"language-text\">[{a: 1}, {b: 2}, {c: 3}]</code> then  response for <code class=\"language-text\">http://localhost:3000/getData</code> will be</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span> a<span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> b<span class=\"token operator\">:</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> c<span class=\"token operator\">:</span> <span class=\"token number\">3</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<p>The <code class=\"language-text\">app</code> param of <code class=\"language-text\">before</code> function can be considered as <code class=\"language-text\">express</code> object and be used in the same context, <code class=\"language-text\">app.get</code> has <code class=\"language-text\">req</code> and <code class=\"language-text\">res</code> params, which are <code class=\"language-text\">request</code> and <code class=\"language-text\">response</code> object for the API call made.</p>\n<blockquote>\n<p>To see this in action please checkout <a href=\"https://github.com/tsl143/react-typescript-app\">this project</a> on github.</p>\n</blockquote>\n<p><strong>Bonus</strong>: I use this technique to get around with CORS on my local setup, the following code does the trick for me:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">  <span class=\"token literal-property property\">devServer</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">before</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">app</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      app<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">const</span> queryURL <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">.</span>q<span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">const</span> resp <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>queryURL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token keyword\">const</span> body <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> resp<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          res<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>Here I fetch the remote URL on the server rather than the browser, so there is no CORS restriction and then serve on the response on the same server hence, eliminating CORS.</p>\n<p>I highly recommend to look into <a href=\"https://webpack.js.org/configuration/dev-server/\">devserver options</a>, this can save a lot of your efforts ðŸ˜Š</p>","frontmatter":{"title":"How to serve an API locally with webpack","tags":["javascript","webpack"],"date":"June 22, 2020","description":null,"author":"trishul","featuredImage":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABuElEQVR42nWS30uTYRTH3z/FyPwxzdmQ11/75dyWLKMySMUSU6IiiLB50QtKzF7nxnTM6atbG/kLo9tAIi8M6dISuqh/QkEC7z8959FFUV58ec75Puec55zzfYxGbzeuji4uNJtUuU3q2oMI19AZ+gvC/Y/Xd2cQ26ht9eNq9fHYShC3M7i9IWpM3z/JEldj+rVdrx6VJgTiX1LxwumCoZt3WHq/x+KXI/L7h5R2D7g+dP93suCyL0ys/x6xgWHq2vyY0V6aFNcciOqifSMP8F7rOy049txi/ftPouldvIkPrP044en0HM+sKTLLr0nll5lfKVHY2CJbKJNccEjM5bBm0iy92eCFnWJWxeTLa7jVA8ZY3NKd+ewdQvZHsvvHPJqc4eH4BM7qJpOpDOnFAtPzC7pQeesd2WJZcSsUN9/yKpsn/tImmXMwI70YkVv9ONufcb4eUjw4ovTpGzfujlLd0qn2GKa2LcCV4FU9nqerhx41evj2oN6ZdCR8S3dMj97kj2DIrho7gjyZSjIxm8MTiOglV9SviFCvbDlFMIHwrjOuIoj4RiXxoqdd47xv8+f3Oe9ORPkFnipChzHFnEkAAAAASUVORK5CYII=","aspectRatio":2.4691358024691357,"src":"/static/41073e0a2825617fd0a67afc6bfeb971/ee604/webpack.png","srcSet":"/static/41073e0a2825617fd0a67afc6bfeb971/69585/webpack.png 200w,\n/static/41073e0a2825617fd0a67afc6bfeb971/497c6/webpack.png 400w,\n/static/41073e0a2825617fd0a67afc6bfeb971/ee604/webpack.png 800w,\n/static/41073e0a2825617fd0a67afc6bfeb971/f3583/webpack.png 1200w,\n/static/41073e0a2825617fd0a67afc6bfeb971/5dfe1/webpack.png 1314w","sizes":"(max-width: 800px) 100vw, 800px"}}}}}},"pageContext":{"slug":"/how-to-serve-api-locally-with-webpack/","previous":{"fields":{"slug":"/resource-coverage-in-the-browser/"},"frontmatter":{"author":"trishul","tags":["browser","javascript","performance"],"title":"Resource coverage in the browser"}},"next":{"fields":{"slug":"/how-to-format-browser-console/"},"frontmatter":{"author":"trishul","tags":["javascript","debugging","console"],"title":"How to use console command effectively"}}}},"staticQueryHashes":["4268877247","764694655"],"slicesMap":{}}