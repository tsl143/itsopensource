{"componentChunkName":"component---src-templates-blog-post-js","path":"/how-to-reduce-node-docker-image-size-by-ten-times/","result":{"data":{"site":{"siteMetadata":{"title":"itsopensource"}},"markdownRemark":{"id":"22459332-bdf2-5bbd-9921-08998d668cbf","excerpt":"Dockerizing an application is simple, effective, but optimizing the size of Docker Image is the tricky part. Docker is easy to use but once the application…","html":"<p>Dockerizing an application is simple, effective, but optimizing the size of Docker Image is the tricky part. Docker is easy to use but once the application starts scaling, the image size inflates exponentially. In general, the node docker image size of the applications is over 1 GB most of the time.</p>\n<h3>Why the Size matters</h3>\n<ol>\n<li>\n<p>Large docker image sizes - Bigger image size requires more space means increased expense.</p>\n</li>\n<li>\n<p>Long build durations - It takes a longer time to push the images over the network and results in CI Pipeline delays.</p>\n</li>\n</ol>\n<h3>Let’s Start The Optimization</h3>\n<p>Here is our <a href=\"https://github.com/championshuttler/fluentbit-dashboard\">demo application</a> built using the VueJS Application.</p>\n<p>Here is the initial Dockerfile.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">FROM node:10\n\nWORKDIR /app\n\nCOPY <span class=\"token builtin class-name\">.</span> /app\n\nEXPOSE <span class=\"token number\">8080</span>\n\nRUN <span class=\"token function\">npm</span> <span class=\"token function\">install</span> http-server <span class=\"token parameter variable\">-g</span>\n\nRUN <span class=\"token function\">npm</span> <span class=\"token function\">install</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">npm</span> run build\n\nCMD http-server ./dist</code></pre></div>\n<p>The size of this image is:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1aba1e73be853f41e369a610752fa9ab/af975/docker1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 7.4324324324324325%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAPklEQVR42h2Kyw3AMAxCjb/3Sq1UZabsPw6JfUDAA3n/zfU9hAihGKnqKCIIgHI3M2NVDevu7szM8f50bn4AVSsVPisnAckAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"docker1\"\n        title=\"\"\n        src=\"/static/1aba1e73be853f41e369a610752fa9ab/fcda8/docker1.png\"\n        srcset=\"/static/1aba1e73be853f41e369a610752fa9ab/12f09/docker1.png 148w,\n/static/1aba1e73be853f41e369a610752fa9ab/e4a3f/docker1.png 295w,\n/static/1aba1e73be853f41e369a610752fa9ab/fcda8/docker1.png 590w,\n/static/1aba1e73be853f41e369a610752fa9ab/efc66/docker1.png 885w,\n/static/1aba1e73be853f41e369a610752fa9ab/c83ae/docker1.png 1180w,\n/static/1aba1e73be853f41e369a610752fa9ab/af975/docker1.png 2478w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>It is 1.34GB! Whoops!</p>\n<p>Let’s start optimizing step by step</p>\n<ol>\n<li>Use <strong>Multi-Stage</strong> Docker Builds</li>\n</ol>\n<p>Multi-stage builds make it easy to optimize Docker images by using multiple <strong>intermediate</strong> images in a single Dockerfile. Read more about it <a href=\"https://docs.docker.com/develop/develop-images/multistage-build/\">here</a>. By using multi-stage builds, we can install all dependencies in the build image and copy them to the leaner runtime image.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">FROM node:10 AS BUILD_IMAGE\n\nWORKDIR /app\n\nCOPY <span class=\"token builtin class-name\">.</span> /app\n\nEXPOSE <span class=\"token number\">8080</span>\n\nRUN <span class=\"token function\">npm</span> <span class=\"token function\">install</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">npm</span> run build\n\nFROM node:10\n\nWORKDIR /app\n\n<span class=\"token comment\"># copy from build image</span>\nCOPY <span class=\"token parameter variable\">--from</span><span class=\"token operator\">=</span>BUILD_IMAGE /app/dist ./dist\nCOPY <span class=\"token parameter variable\">--from</span><span class=\"token operator\">=</span>BUILD_IMAGE /app/node_modules ./node_modules\n\nRUN <span class=\"token function\">npm</span> i <span class=\"token parameter variable\">-g</span> http-server\n\nCMD http-server ./dist</code></pre></div>\n<p>Now the size of this image is 1.24GB:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6b9b07919be16cc2c5c399f5e2e6e50a/ab387/docker2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 6.081081081081082%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAP0lEQVR42jWKuQnAQBADd71/cFxmcDPuvyudETgQmhGS+3mxV6CqcaV+XehuZCZUFSLCbWboZkZ2d3JE8PPnAFreFVdgwVNZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"docker2\"\n        title=\"\"\n        src=\"/static/6b9b07919be16cc2c5c399f5e2e6e50a/fcda8/docker2.png\"\n        srcset=\"/static/6b9b07919be16cc2c5c399f5e2e6e50a/12f09/docker2.png 148w,\n/static/6b9b07919be16cc2c5c399f5e2e6e50a/e4a3f/docker2.png 295w,\n/static/6b9b07919be16cc2c5c399f5e2e6e50a/fcda8/docker2.png 590w,\n/static/6b9b07919be16cc2c5c399f5e2e6e50a/efc66/docker2.png 885w,\n/static/6b9b07919be16cc2c5c399f5e2e6e50a/c83ae/docker2.png 1180w,\n/static/6b9b07919be16cc2c5c399f5e2e6e50a/ab387/docker2.png 2812w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ol start=\"2\">\n<li>Remove Development Dependencies and use <strong>Node Prune</strong> Tool</li>\n</ol>\n<p>node-prune is an open-source tool for removing unnecessary files from the node_modules folder. Test files, markdown files, typing files and *.map files in Npm packages are not required at all in the production environment generally, most of the developers do not remove them from the production package. By using node-prune it can safely be removed.</p>\n<p>We can use this to remove Development Dependencies:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> prune <span class=\"token parameter variable\">--production</span></code></pre></div>\n<p>After making these changes <code class=\"language-text\">Dockerfile</code> will look like:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">FROM node:10 AS BUILD_IMAGE\n\nRUN <span class=\"token function\">curl</span> <span class=\"token parameter variable\">-sfL</span> https://install.goreleaser.com/github.com/tj/node-prune.sh <span class=\"token operator\">|</span> <span class=\"token function\">bash</span> <span class=\"token parameter variable\">-s</span> -- <span class=\"token parameter variable\">-b</span> /usr/local/bin\n\nWORKDIR /app\n\nCOPY <span class=\"token builtin class-name\">.</span> /app\n\nEXPOSE <span class=\"token number\">8080</span>\n\nRUN <span class=\"token function\">npm</span> <span class=\"token function\">install</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">npm</span> run build\n\n<span class=\"token comment\"># remove development dependencies</span>\nRUN <span class=\"token function\">npm</span> prune <span class=\"token parameter variable\">--production</span>\n\n<span class=\"token comment\"># run node prune</span>\nRUN /usr/local/bin/node-prune\n\nFROM node:10\n\nWORKDIR /app\n\n<span class=\"token comment\"># copy from build image</span>\nCOPY <span class=\"token parameter variable\">--from</span><span class=\"token operator\">=</span>BUILD_IMAGE /app/dist ./dist\nCOPY <span class=\"token parameter variable\">--from</span><span class=\"token operator\">=</span>BUILD_IMAGE /app/node_modules ./node_modules\n\nRUN <span class=\"token function\">npm</span> i <span class=\"token parameter variable\">-g</span> http-server\n\nCMD http-server ./dist</code></pre></div>\n<p>By using this we reduced the overall size to 1.09GB</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/154740192b6235545546d6108aac8035/045f9/docker3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 8.783783783783782%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAWklEQVR42j2NQQrAMAgE1SQqQdv+/7NbI7SHgXFllZ7bkXFBXLBilicyE2bWEFEz5+w8ItpPdvZ7b6hqz+4OUmEwC4irKFTOzRjjLx5EBFZFrSPHvydrreabX0alKhP/S1UEAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"docker3\"\n        title=\"\"\n        src=\"/static/154740192b6235545546d6108aac8035/fcda8/docker3.png\"\n        srcset=\"/static/154740192b6235545546d6108aac8035/12f09/docker3.png 148w,\n/static/154740192b6235545546d6108aac8035/e4a3f/docker3.png 295w,\n/static/154740192b6235545546d6108aac8035/fcda8/docker3.png 590w,\n/static/154740192b6235545546d6108aac8035/efc66/docker3.png 885w,\n/static/154740192b6235545546d6108aac8035/c83ae/docker3.png 1180w,\n/static/154740192b6235545546d6108aac8035/045f9/docker3.png 2350w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ol start=\"3\">\n<li>Choose <strong>Smaller Final Base Image</strong></li>\n</ol>\n<p>When dockerizing a node application, there are lots of <a href=\"https://hub.docker.com/_/node/\">base images</a> available to choose from.</p>\n<p>Here we will use <strong>alpine</strong> image; alpine is a lean docker image with minimum packages but enough to run node applications.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">FROM node:10 AS BUILD_IMAGE\n\nRUN <span class=\"token function\">curl</span> <span class=\"token parameter variable\">-sfL</span> https://install.goreleaser.com/github.com/tj/node-prune.sh <span class=\"token operator\">|</span> <span class=\"token function\">bash</span> <span class=\"token parameter variable\">-s</span> -- <span class=\"token parameter variable\">-b</span> /usr/local/bin\n\nWORKDIR /app\n\nCOPY <span class=\"token builtin class-name\">.</span> /app\n\nEXPOSE <span class=\"token number\">8080</span>\n\nRUN <span class=\"token function\">npm</span> <span class=\"token function\">install</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">npm</span> run build\n\n<span class=\"token comment\"># remove development dependencies</span>\nRUN <span class=\"token function\">npm</span> prune <span class=\"token parameter variable\">--production</span>\n\n<span class=\"token comment\"># run node prune</span>\nRUN /usr/local/bin/node-prune\n\nFROM node:10-alpine\n\nWORKDIR /app\n\n<span class=\"token comment\"># copy from build image</span>\nCOPY <span class=\"token parameter variable\">--from</span><span class=\"token operator\">=</span>BUILD_IMAGE /app/dist ./dist\nCOPY <span class=\"token parameter variable\">--from</span><span class=\"token operator\">=</span>BUILD_IMAGE /app/node_modules ./node_modules\n\nRUN <span class=\"token function\">npm</span> i <span class=\"token parameter variable\">-g</span> http-server\n\nCMD http-server ./dist</code></pre></div>\n<p>By using this <code class=\"language-text\">Dockerfile</code> the image size dropped to <code class=\"language-text\">157MB</code> \\o/</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5b1ac48790d94a09ececf55a1e75372c/e3261/docker4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 8.783783783783782%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAVElEQVR42l2MUQrAMAhDtcVWqhPvf9kMy1bYPh7ERyJlGC4PsBLEBXEFIgKqirUWiGjTWoOZITOPn3PC3bcfY4CZQfwM/tSD3vvH1S0ix7+donL1blPEKgSTWx3AAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"docker4\"\n        title=\"\"\n        src=\"/static/5b1ac48790d94a09ececf55a1e75372c/fcda8/docker4.png\"\n        srcset=\"/static/5b1ac48790d94a09ececf55a1e75372c/12f09/docker4.png 148w,\n/static/5b1ac48790d94a09ececf55a1e75372c/e4a3f/docker4.png 295w,\n/static/5b1ac48790d94a09ececf55a1e75372c/fcda8/docker4.png 590w,\n/static/5b1ac48790d94a09ececf55a1e75372c/efc66/docker4.png 885w,\n/static/5b1ac48790d94a09ececf55a1e75372c/c83ae/docker4.png 1180w,\n/static/5b1ac48790d94a09ececf55a1e75372c/e3261/docker4.png 2324w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>Conclusion</h3>\n<p>By applying these 3 simple steps, we reduced our docker image size by 10 times.</p>\n<p>Cheers!</p>","frontmatter":{"title":"How to Reduce Node Docker Image Size by 10X","tags":["docker","tricks","how-to"],"date":"July 03, 2020","description":"Reduce Node Docker Image Size by Ten Times.","author":"shivam","featuredImage":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAADIklEQVR42q1Ue0hTURg/y3sedxX+kUUERhQYQQQVkVRgBNHjj0pipNADIqx2H6tVaCC7RjpXKkZFy/K1Xa8bNxoWmFGoGIWszJIKgh5UlkSZPTBK5nY6d1u2MY3+6IOP73LOd37f73zf71wAJjRqArqeFnVFmQT+jzFQZpP3eWfg47criaM9P7bM1pVO7vf+P+CwxCMtU9GRtvlEvjobH7yynpx9TbHrgT+6r9O0WDTYG8B/s4IaaARy9EYOKQuGibPnB3b2fCeVjyk+dkeN5ihXM7CjvQwUBaYl3iTV4r0ijg6FHQ6SsrsR4rwXweU9YXKil+LS7jfI0eVBha1bifvdKHH11qGj17eAgzofRzCl9Ivsr89kiU/J6eeUlN8L8S4G5rofxszJyT5Kqp6M4uKb1eTsq/fmhi8UH+8OgmwLn8o03hdcFnTydUOUuPt/mt1vI+jcQISwyLv7DQ+Tc/0jPAMiZ14OIbu+CRzyTh6H3R9AUtK5g/cM07S6ryFw/hPNDbyhMxoHKar9RPnajxG+4WvI2CfFHUqsTdGhmMafrGH5Soa54tGLub7PdGPLQHiJ/32E1A5SBkTN2kiYb/xGUUmXB4AcDijU8Ik1ajFkwGyW3bP41I2HDz4MDkWq+4Yj6RfYtU89C7He9sKitvwkAhNaDqNuMQDjidlVfJYSWHVIu5W3qLx1KyjwzUuoHNOfoYoxLSa+pjhtvLdhDmf1Lo8RiAPHpcSJ/pVA0qcnszPieExZxTSxeQ084C+F9ku7OZt3ORS0vGgRQV2NpKbN0H75GJQvLYKythRY9ZlIbs7F+7W5UPYvhLK6Cwm+rDE8KPq2IbFJZgcPQ8l3BUvNApbU3VDUqpGkOojkXQHFpiokql1I1CxQ0ipZbj1zlQFe42TNSuy+zDFALDftg6KajwR1E0sOsO/tWPCuZSABjhWZUlCTwZg7keRrZGvbGLuLSNIaoKSWQJteAQr19GRhs6eDRdXKWO0Bio6I6N2JBM3G3rUZyWqu8c1usAEIgWlY0NYhm2cBJ2oiJ6vLoj236lP+Nm9TijYTp5vye0vO+QUkEGcUSqheawAAAABJRU5ErkJggg==","aspectRatio":1.1695906432748537,"src":"/static/ab093c5a31feb4bf8a49b9452fb5be09/7b9fb/docker.png","srcSet":"/static/ab093c5a31feb4bf8a49b9452fb5be09/69585/docker.png 200w,\n/static/ab093c5a31feb4bf8a49b9452fb5be09/7b9fb/docker.png 336w","sizes":"(max-width: 336px) 100vw, 336px"}}}}}},"pageContext":{"slug":"/how-to-reduce-node-docker-image-size-by-ten-times/","previous":{"fields":{"slug":"/how-to-format-browser-console/"},"frontmatter":{"author":"trishul","tags":["javascript","debugging","console"],"title":"How to use console command effectively"}},"next":{"fields":{"slug":"/how-to-call-a-function-on-URL-change-in-javascript/"},"frontmatter":{"author":"trishul","tags":["javascript","react"],"title":"How to call a function on URL change in javascript"}}}},"staticQueryHashes":["4268877247","764694655"],"slicesMap":{}}