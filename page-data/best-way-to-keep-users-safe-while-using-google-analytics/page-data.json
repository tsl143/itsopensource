{"componentChunkName":"component---src-templates-blog-post-js","path":"/best-way-to-keep-users-safe-while-using-google-analytics/","result":{"data":{"site":{"siteMetadata":{"title":"itsopensource"}},"markdownRemark":{"id":"5f7266b0-d41e-52b5-8d40-d32405bf67bb","excerpt":"Google Analytics is the most used web analytics service over the web, Google has made it pretty easy and effective in terms of implementation and dashboard UI…","html":"<p>Google Analytics is the most used web analytics service over the web, Google has made it pretty easy and effective in terms of implementation and dashboard UI. It gives detailed demographic data and many other features that justify its vast usage.\nThe most common and easiest way to enable google analytics on any website is by adding the tag manager (the code snippet provided) to the website.</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&lt;!-- Global site tag (gtag.js) - Google Analytics --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">async</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://www.googletagmanager.com/gtag/js?id=UA-XXXXXXXXX-1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n  window<span class=\"token punctuation\">.</span>dataLayer <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>dataLayer <span class=\"token operator\">||</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">function</span> <span class=\"token function\">gtag</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>dataLayer<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>arguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">}</span>\n  <span class=\"token function\">gtag</span><span class=\"token punctuation\">(</span><span class=\"token string\">'js'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">gtag</span><span class=\"token punctuation\">(</span><span class=\"token string\">'config'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'UA-XXXXXXXXX-1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n</code></pre></div>\n<h3>Problem</h3>\n<p>Adding a Tag manager is <strong>allowing google to run some code on your website</strong> whenever someone visits the website or do some action (I would request to read this line once more). Based on the options selected on the analytics UI, Google inserts the scripts into the website, sends the data back with <code class=\"language-text\">HTTP requests</code>. Data includes the complete URL(with query params) and many other details that may be classified as <code class=\"language-text\">Personal Identifiable Information(PII)</code>. <a href=\"https://twitter.com/konarkmodi\">Konark Modi</a>, a privacy advocate, has written a detailed case study on how sensitive user data or PII is getting leaked to third parties, including Google Analytics, in <a href=\"https://medium.com/free-code-camp/how-airlines-dont-care-about-your-privacy-case-study-emirates-com-6271b3b8474b\">this blog</a>.\nAs a developer, we always want to have complete control over whatever is being served on our website. Google tag managers kind of blow this up.<br/><br/>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.83783783783784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABCklEQVR42o2O626DMAyF8/6Pt1UdXcUlF0gghQJJyR1muqla1f2Y9ck6tuVjo/M5J4QRyhirpbwI3nLegq4bfumHpuZCtG3bQV1VhBDqnLfWfYMOh+P72yE/FxgTzkXTCMhS9mABehynEOJvYPkBIpjmuDzxT7iPMTzQQC6KCj7iooNmWWJwuR/cbz4tF3nBKCUUa6Wd38dmsctijTEwNgY0SOt9eAVxOZN2xlLftPedDtqlbU33iDE+xJ+B2JgKHi7M2o+rPV6jNGnyKzj8IxAeAhMuYGWzMQgTexd6m2xat21dX9ieQBm3mQgKqzmfVK11fdNigVI1N0WUYloRvZd0z3pwS9qW+MMXrOrGMAlEJ4gAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Leak 1\"\n        title=\"\"\n        src=\"/static/aea8f6f6f589d732daefaf4c628114b8/fcda8/leak1.png\"\n        srcset=\"/static/aea8f6f6f589d732daefaf4c628114b8/12f09/leak1.png 148w,\n/static/aea8f6f6f589d732daefaf4c628114b8/e4a3f/leak1.png 295w,\n/static/aea8f6f6f589d732daefaf4c628114b8/fcda8/leak1.png 590w,\n/static/aea8f6f6f589d732daefaf4c628114b8/71c8e/leak1.png 875w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span><br/>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 3.378378378378378%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAIAAABR8BlyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAARklEQVR42mMI7rod2HnLt+2mT9vNkG4Q27/zFpD0a78V0XfnycuPT58+efT46f0HD588ff7w0ePbd+7evXf//oNHDx4+BgCelyuIA/36rwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Leak 2\"\n        title=\"\"\n        src=\"/static/b6189442e19ff3336b225f97ef1a8d58/fcda8/leak2.png\"\n        srcset=\"/static/b6189442e19ff3336b225f97ef1a8d58/12f09/leak2.png 148w,\n/static/b6189442e19ff3336b225f97ef1a8d58/e4a3f/leak2.png 295w,\n/static/b6189442e19ff3336b225f97ef1a8d58/fcda8/leak2.png 590w,\n/static/b6189442e19ff3336b225f97ef1a8d58/71c8e/leak2.png 875w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3>Solution</h3>\n<p>This can be avoided by using <strong>Google Measurement protocol</strong>.</p>\n<p><em>From the <a href=\"https://developers.google.com/analytics/devguides/collection/protocol/v1\">docs</a></em></p>\n<blockquote>\n<p>The Google Analytics Measurement Protocol allows developers to make HTTP requests to send raw user interaction data directly to Google Analytics servers</p>\n</blockquote>\n<p>TLDR; Do not load google scripts but, create and send HTTP requests by yourself. This gives way more control over what you want to send to google and ensures your complete control over your website. You can send Requests for whatever action needs to be recorded for analytics. It can be just page visits, clicks, or any event.</p>\n<h4>How</h4>\n<p>Analytics tool receives the data via query parameters of the request, a typical request looks like this</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">POST /collect HTTP/1.1\nHost: www.google-analytics.com\n\npayload_data</code></pre></div>\n<p>Mandatory parameters are</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">v=1              // Version of the tool.\n&amp;tid=UA-XXXXX-Y  // Tracking ID / Property ID.\n&amp;cid=555         // Anonymous Client ID.\n&amp;t=              // Hit Type</code></pre></div>\n<p>Google provides a number of parameters in case you want more detailed analytics say for e-commerce, check the parameter guide <a href=\"https://developers.google.com/analytics/devguides/collection/protocol/v1/parameters\">here</a>, some interesting parameters which can be controlled are</p>\n<ul>\n<li><code class=\"language-text\">dr</code> - Document referrer //  = document.referrer</li>\n<li><code class=\"language-text\">dl</code> - Location URL // = document.location.origin + document.location.pathname (also may be document.location.search)</li>\n<li><code class=\"language-text\">aip</code> - Anonymize IP, if present the IP address of the sender will be anonymized // = 1</li>\n<li><code class=\"language-text\">npa</code> - Disable advertising personalization - if enabled  it won’t be used when populating a remarketing audience for “past purchasers” // = 1</li>\n</ul>\n<p><strong>Lesser</strong> the parameters, <strong>lesser</strong> the data sent, <strong>better</strong> the privacy.</p>\n<p>Google also provides a tool to check and create a proper hit via <a href=\"https://ga-dev-tools.appspot.com/hit-builder/\">Hit Builder</a></p>\n<p>If you find this a bit exhausting, then atleast follow the best practices to make sure You are not sending the user’s personal data to google.\n<a href=\"https://support.google.com/analytics/answer/6366371\">https://support.google.com/analytics/answer/6366371</a></p>\n<p><strong><center>--- Keep your users safe ---</center></strong></p>","frontmatter":{"title":"Best way to keep users safe while using Google Analytics","tags":["javascript","analytics","privacy"],"date":"July 11, 2020","description":"It's not easy to get away from Google Analytics even if it leaks user data, but how about limiting the data sent to google and still have decent analytics.","author":"trishul","featuredImage":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABYBAQEBAAAAAAAAAAAAAAAAAAEAAv/aAAwDAQACEAMQAAABxqlOQQX/xAAaEAACAgMAAAAAAAAAAAAAAAABAiEiABES/9oACAEBAAEFAgugRhWeqBrFp//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABkQAAIDAQAAAAAAAAAAAAAAAAERABAxUf/aAAgBAQAGPwJxDeUoCq//xAAbEAADAQADAQAAAAAAAAAAAAAAAREhMUFRof/aAAgBAQABPyGg9kxr0ptvpv0jDOaBSUhosx//2gAMAwEAAgADAAAAEED/AP/EABYRAQEBAAAAAAAAAAAAAAAAAAERAP/aAAgBAwEBPxCMXF3/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAcEAEAAgMBAQEAAAAAAAAAAAABESEAMVFBYaH/2gAIAQEAAT8QR4BQSfDks8ZNyM+LvWoyeQng0YqakUW93hi+V3WO6P3P/9k=","aspectRatio":1.4184397163120568,"src":"/static/d1abed081ff81400876c77c295fdf08d/14b42/data-protection.jpg","srcSet":"/static/d1abed081ff81400876c77c295fdf08d/f836f/data-protection.jpg 200w,\n/static/d1abed081ff81400876c77c295fdf08d/2244e/data-protection.jpg 400w,\n/static/d1abed081ff81400876c77c295fdf08d/14b42/data-protection.jpg 800w,\n/static/d1abed081ff81400876c77c295fdf08d/47498/data-protection.jpg 1200w,\n/static/d1abed081ff81400876c77c295fdf08d/ec6c5/data-protection.jpg 1280w","sizes":"(max-width: 800px) 100vw, 800px"}}}}}},"pageContext":{"slug":"/best-way-to-keep-users-safe-while-using-google-analytics/","previous":{"fields":{"slug":"/how-to-call-a-function-on-URL-change-in-javascript/"},"frontmatter":{"author":"trishul","tags":["javascript","react"],"title":"How to call a function on URL change in javascript"}},"next":{"fields":{"slug":"/decoupling-drupal-using-json-api/"},"frontmatter":{"author":"dipali","tags":["php"],"title":"Decoupled DRUPAL 8 With JSON API"}}}},"staticQueryHashes":["4268877247","764694655"],"slicesMap":{}}