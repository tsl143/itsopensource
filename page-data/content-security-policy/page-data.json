{"componentChunkName":"component---src-templates-blog-post-js","path":"/content-security-policy/","result":{"data":{"site":{"siteMetadata":{"title":"itsopensource"}},"markdownRemark":{"id":"770e9c15-faf8-5d86-a71d-b4e6d077b4f0","excerpt":"Problem It’s very common while building any project we use certain third party libraries, in the case of Javascript; , which recursively use more packages, and…","html":"<h3>Problem</h3>\n<p>It’s very common while building any project we use certain third party libraries, in the case of Javascript; <code class=\"language-text\">npm packages</code>, which recursively use more packages, and eventually your code includes a huge chunk of third party code.<br>\nThere is nothing wrong with it, there is no point re-inventing the wheel. We include the required library, make our code work, write tests. Deploy to a staging environment, pass through automation and finally deploy to production.  </p>\n<p>The problem is when a library tries to load remote content on our website. It can be an image, font, style, or even Javascript. This content bypasses all our tests, checks, and is executed directly on production. Even worse we don’t know where the content is being served from.</p>\n<h3>Content Security Policy</h3>\n<p>Content Security Policy (CSP) is a <a href=\"https://www.w3.org/TR/CSP3/\">W3C specification</a> that helps to avoid <code class=\"language-text\">XSS</code> attacks. CSP enables developers to define rules for fetching the resources(images, javascript, fonts, etc.) on the client browser. Developers can define policies to allow/restrict loading any resource, restrict resources to load only from certain domains, and disallow from any other domain. For example, you can write a CSP to restrict browsers to load images only from <code class=\"language-text\">example.com</code>, any images from other domains will be not loaded and would throw errors. In addition to resources, CSP also offers control over the embeds.<br>\nIn the following example, the CSP forces to load images/scripts only from self domain and prevents the loading of images from other domains.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f79845e666a27a2b69fb967dbc09c072/09e48/csp1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.02702702702703%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB+UlEQVQoz2WSCW/TQBCF/f9/DUIURIUoEqitKKVH7sTO4STO4djxtb7tj/GWCgFrjd74zezzG+8ay+WK/f7AamWzWCxxjwduzIwv45RrQdvLOIU+c2uB657o+mcz86VX3rdbR/auiKIY215jbNYb4jgmDEKCICCOIqqqoaxairKhBclLlFKUZUmWZahEkaYpRVFo7Gp103B3cyuCux3e+YwvYq7naQyjkEQlxEmM5/siXFLWNUVVCVY6z4Vr+HuZ0wmGO57iTE22MpLVH7KXUdamhWPN2S9tzN6As4wVHlzC4wl/4+BJbGWPkpEbcVtlBbkq5XedMRhZFA990u8PFE9DyrFF9rOno8vLwYT0/pn0cYC6e9SYPY+oLJtyuaHa7KmDlGAXszEdjOp5TD6YovqycTgjny3IRiapcPl0oTHtjQUnmlfyUSWCXV9pO1T2TvgZ7WzOeS6H0nohStyc3n7Ae3eJf3mF++YC/+NnvPefNB9cfcO7uCT8eqvzRPqLzuHK0aL10Qc/Itm5MnKUkslowZdrott7ous74h9P2pnqjcjEdbFYvzifzLVAJ6bd98X5cEp9CiDJKQSNvPupaUYdy9GrjCYvaKsaGrkw3Z0RbLv8d7R1o+O13tW6/k5jMLEwmvblrv27Oq5tpVk/8Cd7rbf/cYejyy8Uy+6dtXQHjwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"CSP block\"\n        title=\"CSP block\"\n        src=\"/static/f79845e666a27a2b69fb967dbc09c072/fcda8/csp1.png\"\n        srcset=\"/static/f79845e666a27a2b69fb967dbc09c072/12f09/csp1.png 148w,\n/static/f79845e666a27a2b69fb967dbc09c072/e4a3f/csp1.png 295w,\n/static/f79845e666a27a2b69fb967dbc09c072/fcda8/csp1.png 590w,\n/static/f79845e666a27a2b69fb967dbc09c072/efc66/csp1.png 885w,\n/static/f79845e666a27a2b69fb967dbc09c072/09e48/csp1.png 974w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><em>From the <a href=\"https://www.w3.org/TR/CSP3/\">W3c specification</a> docs:</em> </p>\n<blockquote>\n<p>One of the CSP goal is to mitigate the risk of content-injection attacks by giving developers fairly granular control over</p>\n<ul>\n<li>The resources which can be requested (and subsequently embedded or executed) on behalf of a specific Document or Worker</li>\n<li>The execution of inline script</li>\n<li>Dynamic code execution (via eval() and similar constructs)</li>\n<li>The application of inline style</li>\n</ul>\n</blockquote>\n<h3>How</h3>\n<p>CSP can be implemented in following two ways:</p>\n<ol>\n<li>\n<p>Specify in <strong>HTTP headers</strong> </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Content-Security-Policy: __Policy__</code></pre></div>\n</li>\n<li>\n<p>Specify in <strong>META tags</strong> </p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Content-Security-Policy<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span> __Policy__ <span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></code></pre></div>\n</li>\n</ol>\n<h4>Defining a policy</h4>\n<p>The Policy is the accumulation of directives which defines the allowed location of each resource, no directive means allowed for all. Some of the useful directives are the following:</p>\n<ul>\n<li><em>default-src</em> : This defines the loading policy for all types of resources.</li>\n<li><em>script-src</em> : This defines the loading policy for all javascript, from where javascript can be loaded.</li>\n<li><em>img-src</em> : This defines the loading policy for all images, from where images can be loaded. </li>\n</ul>\n<p>List of directives for the other resources is <a href=\"https://developers.google.com/web/fundamentals/security/csp#policy_applies_to_a_wide_variety_of_resources\">here</a>.</p>\n<p>Some examples of policies are:</p>\n<ol>\n<li>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Content-Security-Policy: default-src &#39;self&#39;;</code></pre></div>\n<p>This would allow resources only from the same domain, and all other resources will fail to load.</p>\n</li>\n<li>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Content-Security-Policy: img-src example.com;</code></pre></div>\n<p>This would allow images only from <code class=\"language-text\">example.com</code>, and all other images will fail to load.</p>\n</li>\n<li>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Content-Security-Policy: default-src &#39;self&#39;; img-src example.com;</code></pre></div>\n<p>This would allow any resources to load only if from the same domain, except images which can be from <code class=\"language-text\">example.com</code> too.</p>\n</li>\n</ol>\n<h4>Reporting</h4>\n<p>CSP also provides a way to send violation reports, in case any logging is required, via <code class=\"language-text\">report-uri</code> directive. </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">`Content-Security-Policy: default-src &#39;self&#39;; report-uri http://example.com/cspfails` </code></pre></div>\n<p>The reports will be sent as POST request and with following JSON: </p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n <span class=\"token property\">\"csp-report\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n   <span class=\"token property\">\"document-uri\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://example.com/\"</span><span class=\"token punctuation\">,</span>\n   <span class=\"token property\">\"referrer\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>\n   <span class=\"token property\">\"blocked-uri\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://example.com/some_malware.js\"</span><span class=\"token punctuation\">,</span>\n   <span class=\"token property\">\"violated-directive\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"default-src self\"</span><span class=\"token punctuation\">,</span>\n   <span class=\"token property\">\"original-policy\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"default-src 'self'; report-uri http://example.com/cspfails\"</span>\n <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<h3>Risks</h3>\n<p>Before defining a CSP you should be completely aware of all the resources and respective origin required for your webapp, else some vital resources may be blocked and eventually random bugs.\nIn case you are not sure what all resources are being required for running your web page smoothly, you can implement the CSP in reporting mode, in this way the violations will be reported but no resource will be blocked, once you are sure what are the resources really required, you can implement CSP. To do this instead of <code class=\"language-text\">Content-Security-Policy</code> we need to use <code class=\"language-text\">Content-Security-Policy-Report-Only</code> header. </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Content-Security-Policy-Report-Only: __Policy__ + report-uri</code></pre></div>\n<h3>Resources -</h3>\n<ul>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP\">https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP</a></li>\n<li><a href=\"https://csplite.com/csp/?rub=0&#x26;cat=0\">https://csplite.com/csp/?rub=0&#x26;cat=0</a></li>\n</ul>","frontmatter":{"title":"Content Security Policy - protect your website from XSS attacks","tags":["privacy","javascript"],"date":"October 25, 2020","description":null,"author":"trishul","featuredImage":null}}},"pageContext":{"slug":"/content-security-policy/","previous":{"fields":{"slug":"/checkout-git-pull-request-locally-like-pro/"},"frontmatter":{"author":"shivam","tags":["git","github","howto"],"title":"How to checkout github pull requests locally like Pro"}},"next":{"fields":{"slug":"/creating-accordions-with-native-html/"},"frontmatter":{"author":"shivam","tags":["html","mindblowing","how-to"],"title":"Creating accordions with native HTML"}}}},"staticQueryHashes":["4268877247","764694655"]}